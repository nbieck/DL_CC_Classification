\section{Results}

%LaTeX magic that lets me create a new column in a table with the format a \pm b
\def\pgfmathprintpmnumber#1#2{%
    \pgfmathfloatparsenumber{\thisrow{#1}}%
    \let\valueAvg=\pgfmathresult
    \pgfmathfloatparsenumber{\thisrow{#2}}%
    \let\valueStd=\pgfmathresult
    \edef\valueAvg{\noexpand\pgfmathprintnumber[std, precision=2]{\valueAvg}}%
    \edef\valueStd{\noexpand\pgfmathprintnumber[std, precision=2]{\valueStd}}%
    \toks0=\expandafter{\valueAvg}%
    \toks1=\expandafter{\valueStd}%
    \edef\value{\the\toks0$\pm$\the\toks1}%
}

%load the data for our model with 17 flowers
\pgfplotstableread{data/ours_17_flowers_summary.csv}{\ourssmallsummary}
{\scriptsize
\pgfplotstabletypeset[
    col sep=comma,
    columns={Algorithm, train_time, test_time, 
        train_loss, val_loss, test_acc},
    column type = c,
    columns/Algorithm/.style={string type, column name=},
    columns/train_time/.style = {string type, column name ={Training (s)}},
    create on use/train_time/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{train_time_avg}{train_time_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/test_time/.style = {string type, column name ={Testing (s)}},
    create on use/test_time/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{test_time_avg}{test_time_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/train_loss/.style = {string type, column name ={Train Loss}},
    create on use/train_loss/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{train_loss_avg}{train_loss_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/val_loss/.style = {string type, column name ={Val Loss}},
    create on use/val_loss/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{val_loss_avg}{val_loss_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/test_acc/.style = {string type, column name ={Test Acc}},
    create on use/test_acc/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{test_acc_avg}{test_acc_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    every head row/.style = {before row=\hline, after row=\hline},
    every last row/.style = {after row=\hline},
    every column/.style = {column type/.add={|}{}},
    every last column/.style = {column type/.add={}{|}},
]{\ourssmallsummary}
}

\begin{figure}
    \centering
    \begin{tabular}{cc}
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Time,
                ylabel = Time/s,
                ybar,
                xtick=data,
                xticklabels from table = {\ourssmallsummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_time_avg,
                    y error=train_time_std,
                ] {\ourssmallsummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_time,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}&
        \begin{tikzpicture}
            \begin{axis}[
                title = Testing Time,
                ybar,
                xtick=data,
                xticklabels from table = {\ourssmallsummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ylabel=Time/s,
                no markers,
                ymin=0,
                width=0.49\textwidth,
                bar width=6.pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_time_avg,
                    y error=test_time_std,
                ] {\ourssmallsummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_time,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Loss,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourssmallsummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_loss_avg,
                    y error=train_loss_std,
                ] {\ourssmallsummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_loss,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}&
        \begin{tikzpicture}
            \begin{axis}[
                title = Validation Loss,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourssmallsummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=val_loss_avg,
                    y error=val_loss_std,
                ] {\ourssmallsummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=val_loss,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Test Accuracy,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourssmallsummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_acc_avg,
                    y error=test_acc_std,
                ] {\ourssmallsummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_acc,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}
    \end{tabular}
    \caption{Comparison a comparison of the different color constancy methods on the 17 flower dataset using our model (blue) and VGG16 (orange).}
    \label{fig:comparison_17_flowers}
\end{figure}

%load all tables for the following graphs so we don't need to load the file for each one
\pgfplotstableread{data/train_loss_17_flowers.csv}\ourssmalltrainloss
\pgfplotstableread{data/train_accuracy_17_flowers.csv}\ourssmalltrainacc
\pgfplotstableread{data/validation_loss_17_flowers.csv}\ourssmallvalloss
\pgfplotstableread{data/validation_accuracy_17_flowers.csv}\ourssmallvalacc

\def\historygraphheight{4.395cm}

\begin{figure}
    %We use a centered table with a single right-aligned column to ensure that the graphs
    %visually lign up while still being centered on the page
    \centering
    \begin{tabular}{r}
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Loss over Time,
                mark repeat=1,
                xlabel = Epoch,
                ylabel = Loss,
                width=0.95\textwidth,
                height=\historygraphheight,
                each nth point={4},
                legend columns=2,
            ]
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = Base,
                ] {\ourssmalltrainloss};
                \addlegendentry{Base}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = BatchNorm,
                ] {\ourssmalltrainloss};
                \addlegendentry{Batch Norm}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = FC4,
                ] {\ourssmalltrainloss};
                \addlegendentry{FC\textsuperscript{4}}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = WhitePatch,
                ] {\ourssmalltrainloss};
                \addlegendentry{White Patch}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyEdge,
                ] {\ourssmalltrainloss};
                \addlegendentry{Grey Edge}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyWorld,
                ] {\ourssmalltrainloss};
                \addlegendentry{Grey World}
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Validation Loss over Time,
                mark repeat=1,
                xlabel = Epoch,
                ylabel = Loss,
                width=0.95\textwidth,
                height=\historygraphheight,
                each nth point={4},
                legend columns=2,
            ]
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = Base,
                ] {\ourssmallvalloss};
                \addlegendentry{Base}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = BatchNorm,
                ] {\ourssmallvalloss};
                \addlegendentry{Batch Norm}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = FC4,
                ] {\ourssmallvalloss};
                \addlegendentry{FC\textsuperscript{4}}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = WhitePatch,
                ] {\ourssmallvalloss};
                \addlegendentry{White Patch}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyEdge,
                ] {\ourssmallvalloss};
                \addlegendentry{Grey Edge}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyWorld,
                ] {\ourssmallvalloss};
                \addlegendentry{Grey World}
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Accuracy over Time,
                mark repeat=1,
                xlabel = Epoch,
                ylabel = Accuracy,
                legend pos=south east,
                width=0.95\textwidth,
                height=\historygraphheight,
                each nth point={4},
                legend columns=2,
            ]
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = Base,
                ] {\ourssmalltrainacc};
                \addlegendentry{Base}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = BatchNorm,
                ] {\ourssmalltrainacc};
                \addlegendentry{Batch Norm}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = FC4,
                ] {\ourssmalltrainacc};
                \addlegendentry{FC\textsuperscript{4}}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = WhitePatch,
                ] {\ourssmalltrainacc};
                \addlegendentry{White Patch}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyEdge,
                ] {\ourssmalltrainacc};
                \addlegendentry{Grey Edge}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyWorld,
                ] {\ourssmalltrainacc};
                \addlegendentry{Grey World}
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Validation Accuracy over Time,
                mark repeat=1,
                xlabel = Epoch,
                ylabel = Accuracy,
                legend pos=south east,
                width=0.95\textwidth,
                height=\historygraphheight,
                each nth point={4},
                legend columns=2,
            ]
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = Base,
                ] {\ourssmallvalacc};
                \addlegendentry{Base}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = BatchNorm,
                ] {\ourssmallvalacc};
                \addlegendentry{Batch Norm}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = FC4,
                ] {\ourssmallvalacc};
                \addlegendentry{FC\textsuperscript{4}}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = WhitePatch,
                ] {\ourssmallvalacc};
                \addlegendentry{White Patch}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyEdge,
                ] {\ourssmallvalacc};
                \addlegendentry{Grey Edge}
                \addplot+[
                    smooth,
                ] table[
                    x = Epoch,
                    y = GreyWorld,
                ] {\ourssmallvalacc};
                \addlegendentry{Grey World}
            \end{axis}
        \end{tikzpicture}
    \end{tabular}
    \caption{For each algorithm, the development of training and validation loss and accuracy are shown 
    for the trial ending on the lowest validation loss respectively.}
    \label{fig:ours_17_flowers_history}
\end{figure}

%load the data for our model with 102 flowers
\pgfplotstableread{data/ours_102_flowers_summary.csv}{\ourslargesummary}
{\scriptsize
\pgfplotstabletypeset[
    col sep=comma,
    columns={Algorithm, train_time, test_time, 
        train_loss, val_loss, test_acc},
    column type = c,
    columns/Algorithm/.style={string type, column name=},
    columns/train_time/.style = {string type, column name ={Training (s)}},
    create on use/train_time/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{train_time_avg}{train_time_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/test_time/.style = {string type, column name ={Testing (s)}},
    create on use/test_time/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{test_time_avg}{test_time_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/train_loss/.style = {string type, column name ={Train Loss}},
    create on use/train_loss/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{train_loss_avg}{train_loss_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/val_loss/.style = {string type, column name ={Val Loss}},
    create on use/val_loss/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{val_loss_avg}{val_loss_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    columns/test_acc/.style = {string type, column name ={Test Acc}},
    create on use/test_acc/.style={%
        create col/assign/.code={%
            \pgfmathprintpmnumber{test_acc_avg}{test_acc_std}
            \pgfkeyslet{/pgfplots/table/create col/next content}\value
        }
    },
    every head row/.style = {before row=\hline, after row=\hline},
    every last row/.style = {after row=\hline},
    every column/.style = {column type/.add={|}{}},
    every last column/.style = {column type/.add={}{|}},
]{\ourslargesummary}
}

\begin{figure}
    \centering
    \begin{tabular}{cc}
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Time,
                ylabel = Time/s,
                ybar,
                xtick=data,
                xticklabels from table = {\ourslargesummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_time_avg,
                    y error=train_time_std,
                ] {\ourslargesummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_time,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}&
        \begin{tikzpicture}
            \begin{axis}[
                title = Testing Time,
                ybar,
                xtick=data,
                xticklabels from table = {\ourslargesummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ylabel=Time/s,
                no markers,
                ymin=0,
                width=0.49\textwidth,
                bar width=6.pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_time_avg,
                    y error=test_time_std,
                ] {\ourslargesummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_time,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Training Loss,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourslargesummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_loss_avg,
                    y error=train_loss_std,
                ] {\ourslargesummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=train_loss,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}&
        \begin{tikzpicture}
            \begin{axis}[
                title = Validation Loss,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourslargesummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=val_loss_avg,
                    y error=val_loss_std,
                ] {\ourslargesummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=val_loss,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}\\
        \begin{tikzpicture}
            \begin{axis}[
                title = Test Accuracy,
                ylabel = Loss,
                ybar,
                xtick=data,
                xticklabels from table = {\ourslargesummary}{Algorithm},
                x tick label style = {rotate=45, anchor=east},
                error bars/y dir=both,
                error bars/y explicit,
                error bars/error bar style={black},
                ymin=0,
                width=0.49\textwidth,
                bar width=6pt,
            ]
                \addplot+[
                    draw=black,
                    fill=ourblue,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_acc_avg,
                    y error=test_acc_std,
                ] {\ourslargesummary};
                \addplot+[
                    draw=black,
                    fill=ourorange,
                ] table[
                    col sep=comma,
                    x expr=\coordindex,
                    y=test_acc,
                ] {data/vgg16_17_flowers_summary.csv};
            \end{axis}
        \end{tikzpicture}
    \end{tabular}
    \caption{Comparison a comparison of the different color constancy methods on the 102 flower dataset using our model (blue) and VGG16 (orange).}
    \label{fig:comparison_102_flowers}
\end{figure}